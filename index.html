<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
  <title>Classified Ads</title>
</head>
<body>
  <h1>Title:</h1>
  <ul>
  </ul>
  
  <script>
    fetchData('https://wiki-ads.onrender.com/categories')
        .then(data => {
            const ul = document.querySelector('ul');

            data.forEach(category => {
                // Render category title
                const titleMarkup = `<li>${category.title}</li>`;
                ul.insertAdjacentHTML('beforeend', titleMarkup);

                // Render category image and link reference
                const id = category.id;
                const path = `category.html`;
                const imgMarkup = `
                    <li>
                        <a href="${path}">
                            <img src="${category.img_url}" ">
                        </a>
                        <ul id="subcategories-${id}"></ul>
                    </li>`;
                ul.insertAdjacentHTML('beforeend', imgMarkup);

                // Fetch subcategories
                const subcategoriesPath = `https://wiki-ads.onrender.com/ads?category=${id}`;
                fetchData(subcategoriesPath)
                    .then(subcategories => {
                        const subcategoriesUl = document.getElementById(`subcategories-${id}`);

                        subcategories.forEach(subcategory => {
                            // Render subcategory title
                            const subcategoryMarkup = `<li>${subcategory.title}</li>`;
                            subcategoriesUl.insertAdjacentHTML('beforeend', subcategoryMarkup);
                        });
                    });
            });
        });

    function fetchData(url) {
        return fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Network response was not ok (${response.status} - ${response.statusText})`);
                }
                return response.json();
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    }
</script>


</body>
</html>